<!DOCTYPE html>
<html>
<head>
<title>Pressure Carbon Footprint</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body { font-family: Poppins; background:#f4f4f4; padding:30px; }
.chart-container {
  width: 80%;
  margin: auto;
  background: white;
  padding: 20px;
  border-radius: 20px;
}
.glow { box-shadow: 0 0 25px red; }
  .back-btn {
  display: inline-block;
  margin: 10px 0 20px 10%;
  padding: 10px 18px;
  background-color: #2D6A4F;
  color: white;
  text-decoration: none;
  font-weight: 600;
  border-radius: 8px;
  transition: background 0.3s, transform 0.2s;
}

.back-btn:hover {
  background-color: #1b4332;
  transform: translateX(-3px);
}

</style>
</head>

<body>
  <a href="index.html" class="back-btn">⬅ Back to Main</a>

<h2 align="center">Pressure Process – Mechanical Emission</h2>

<div class="chart-container" id="container">
  <canvas id="chart"></canvas>
</div>

<script>
const API_URL = "https://fastapi-carbon-backend.onrender.com/carbon-footprint/hourly";
const ctx = document.getElementById("chart").getContext("2d");

const chart = new Chart(ctx,{
 type:"line",
 data:{
  labels:[],
  datasets:[
   {label:"Pressure Emission(mg CO2)",data:[],borderWidth:2, tension: 0.4},
  
   {label:"Average",data:[],borderDash:[5,5],borderColor:"blue",pointRadius:0},
   {label:"Peak",data:[],borderDash:[2,2],borderColor:"purple",pointRadius:0}
  ]
 }
});
function updateCharts(){
 fetch(API_URL)
   .then(r => r.json())
   .then(res => {
     console.log("Pressure API data:", res.data);

     const data = res.data || [];

     //  Convert kg → miligrams (fix flat line)
     const values = data.map(d => d.pressure_carbon * 1_000_000);

     const avg = values.reduce((a,b)=>a+b,0) / (values.length || 1);
     const peak = Math.max(...values, 0);

     chart.data.labels = data.map(d => d.hour);
     chart.data.datasets[0].data = values;
     chart.data.datasets[1].data = values.map(()=>avg);
     chart.data.datasets[2].data = values.map(()=>peak);

     let color = "green";
     if (peak > 800) color = "red";
     else if (peak > 400) color = "orange";

     chart.data.datasets[0].borderColor = color;
     document.getElementById("container")
       ?.classList.toggle("glow", color==="red");

     chart.options.scales = {
       y: {
         min: 0,
         max: peak * 1.3
       }
     };

     chart.update();
   });
}


updateCharts();
setInterval(updateCharts,60000);
</script>
</body>
</html>






