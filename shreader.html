
<!DOCTYPE html>
<html>
<head>
  <title>Shredder Carbon Footprint</title>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Annotation Plugin (FOR ZONES) -->
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.4.0"></script>

  <style>
    body {
      font-family: Poppins;
      background: #f4f4f4;
      padding: 30px;
    }

    .chart-container {
      width: 80%;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 20px;
      transition: box-shadow 0.3s;
    }

    .glow {
      box-shadow: 0 0 25px red;
    }

    .back-btn {
      display: inline-block;
      margin: 10px 0 20px 10%;
      padding: 10px 18px;
      background-color: #2D6A4F;
      color: white;
      text-decoration: none;
      font-weight: 600;
      border-radius: 8px;
    }
  </style>
</head>

<body>

<a href="index.html" class="back-btn">⬅ Back to Main</a>
<h2 align="center">Shredder – Electricity Emission</h2>

<div class="chart-container" id="container">
  <canvas id="chart"></canvas>
</div>

<script>
/* ================= CONFIG ================= */

const API_URL = "https://fastapi-carbon-backend.onrender.com/carbon-footprint/hourly";

// Emission limits (mg CO₂)
const SAFE_LIMIT = 1;
const WARNING_LIMIT = 2;

/* ================= CHART ================= */

const ctx = document.getElementById("chart").getContext("2d");

const chart = new Chart(ctx, {
  type: "line",
  data: {
    labels: [],
    datasets: [
      {
        label: "Shredding Emission (mg CO₂)",
        data: [],
        borderWidth: 2,
        tension: 0.3
      },
      {
        label: "Average Emission",
        data: [],
        borderDash: [5,5],
        borderColor: "blue",
        pointRadius: 0
      },
      {
        label: "Peak Emission",
        data: [],
        borderDash: [2,2],
        borderColor: "purple",
        pointRadius: 0
      }
    ]
  },
  options: {
    scales: {
      y: {
        beginAtZero: true
      }
    },
    plugins: {
      annotation: {
        annotations: {
          greenZone: {
            type: 'box',
            yMin: 0,
            yMax: SAFE_LIMIT,
            backgroundColor: 'rgba(0, 200, 0, 0.15)'
          },
          yellowZone: {
            type: 'box',
            yMin: SAFE_LIMIT,
            yMax: WARNING_LIMIT,
            backgroundColor: 'rgba(255, 165, 0, 0.18)'
          },
          redZone: {
            type: 'box',
            yMin: WARNING_LIMIT,
            yMax: 100,
            backgroundColor: 'rgba(255, 0, 0, 0.15)'
          }
        }
      }
    }
  }
});

/* ================= UPDATE FUNCTION ================= */

function updateCharts() {
  fetch(API_URL)
    .then(res => res.json())
    .then(res => {

      const data = res.data || [];

      // Convert kg → mg
      const values = data.map(d => d.shredding_carbon * 1_000_000);

      const avg = values.reduce((a,b)=>a+b,0) / (values.length || 1);
      const peak = Math.max(...values, 0);

      chart.data.labels = data.map(d => d.hour);
      chart.data.datasets[0].data = values;
      chart.data.datasets[1].data = values.map(() => avg);
      chart.data.datasets[2].data = values.map(() => peak);

      /* COLOR + GLOW LOGIC */
      let color = "green";
      if (peak > WARNING_LIMIT) color = "red";
      else if (peak > SAFE_LIMIT) color = "orange";

      chart.data.datasets[0].borderColor = color;

      document
        .getElementById("container")
        .classList.toggle("glow", color === "red");

      chart.options.scales.y.max = peak * 1.3;

      chart.update();
    });
}

/* ================= RUN ================= */

updateCharts();
setInterval(updateCharts, 60000); // every 1 min
</script>

</body>
</html>




